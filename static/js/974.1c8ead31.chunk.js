"use strict";(self.webpackChunkcampus_connect_react=self.webpackChunkcampus_connect_react||[]).push([[974],{974:(e,t,s)=>{s.r(t),s.d(t,{default:()=>m});var a=s(5043),n=s(1056),o=s(579);var r=s(5016),i=s(4032),c=s(9379),l=s(6471),d=s(3415);const m=()=>{var e,t,s,m,u,x,g,h;const{user:b}=(0,r.A)(),{connections:p}=(0,i.M)(),[f,v]=(0,a.useState)(null),[j,y]=(0,a.useState)(""),[N,w]=(0,a.useState)("direct"),A=(0,a.useRef)(null),D=(0,a.useRef)(null),[k,S]=(0,a.useState)(!1),[C,M]=(0,a.useState)(""),{messages:T,isTyping:I,sendChatMessage:F,handleTypingStart:L,loadChatHistory:_,retryMessage:E,markAsRead:G}=(()=>{const{user:e}=(0,r.A)(),{connections:t,sendMessage:s}=(0,i.M)(),{showError:n}=(0,l.h)(),[o,m]=(0,a.useState)({}),[u,x]=(0,a.useState)({}),[g,h]=(0,a.useState)({});(0,a.useEffect)(()=>(console.log("Setting up chat connection..."),()=>{console.log("Cleaning up chat connection...")}),[]);const b=(0,a.useCallback)((e,t)=>{m(s=>{var a;return(0,c.A)((0,c.A)({},s),{},{[e]:[...s[e]||[],{id:Date.now(),senderId:t.senderId,message:t.content,timestamp:new Date,sequence:((null===(a=s[e])||void 0===a?void 0:a.length)||0)+1,sent:!1}]})})},[]),p=(0,a.useCallback)(async(t,a)=>{var r;const i=(0,d.Pu)(a);if(!i)return n("Message contains invalid content"),!1;const l=Date.now(),u={id:l,senderId:null===e||void 0===e?void 0:e.id,message:i,timestamp:new Date,sequence:((null===(r=o[t])||void 0===r?void 0:r.length)||0)+1,sent:!0,pending:!0};m(e=>(0,c.A)((0,c.A)({},e),{},{[t]:[...e[t]||[],u]}));try{return await s(t,i),m(e=>(0,c.A)((0,c.A)({},e),{},{[t]:e[t].map(e=>e.id===l?(0,c.A)((0,c.A)({},e),{},{pending:!1}):e)})),!0}catch(x){return m(e=>(0,c.A)((0,c.A)({},e),{},{[t]:e[t].map(e=>e.id===l?(0,c.A)((0,c.A)({},e),{},{failed:!0}):e)})),n("Failed to send message. Please try again."),!1}},[null===e||void 0===e?void 0:e.id,o,s,n]),f=(0,a.useCallback)(e=>{g[e]&&clearTimeout(g[e]),x(t=>(0,c.A)((0,c.A)({},t),{},{[e]:!0}));const t=setTimeout(()=>{x(t=>(0,c.A)((0,c.A)({},t),{},{[e]:!1}))},3e3);h(s=>(0,c.A)((0,c.A)({},s),{},{[e]:t}))},[g]),v=(0,a.useCallback)(async e=>{try{console.log("Loading chat history for ".concat(e,"..."))}catch(t){n("Failed to load chat history")}},[n]),j=(0,a.useCallback)(async(e,t)=>{var s;const a=null===(s=o[e])||void 0===s?void 0:s.find(e=>e.id===t);if(a)return m(s=>(0,c.A)((0,c.A)({},s),{},{[e]:s[e].filter(e=>e.id!==t)})),p(e,a.message)},[o,p]),y=(0,a.useCallback)(e=>{console.log("Marking messages as read for chat ".concat(e))},[]);return{messages:o,isTyping:u,sendChatMessage:p,handleTypingStart:f,loadChatHistory:v,retryMessage:j,markAsRead:y,handleIncomingMessage:b}})(),[q]=(0,a.useState)([{id:"ai-workshop",name:"AI Workshop Discussion",description:"Discuss AI development techniques and share resources",members:45,lastMessage:"Great session today! Anyone has the slides?",lastMessageTime:new Date(Date.now()-3e5),unread:3,avatar:"AI"},{id:"career-fair",name:"Career Fair 2025",description:"Tips, experiences, and networking for the upcoming career fair",members:120,lastMessage:"Microsoft booth was amazing!",lastMessageTime:new Date(Date.now()-6e5),unread:0,avatar:"CF"},{id:"hackathon-team",name:"Innovation Challenge Team",description:"Coordination for the 48-hour hackathon",members:8,lastMessage:"Meeting at 2 PM in lab 3",lastMessageTime:new Date(Date.now()-9e5),unread:1,avatar:"HC"}]),[H,O]=(0,a.useState)({1:[{id:1,senderId:1,message:"Hey! Great presentation today!",timestamp:new Date(Date.now()-3e5),sent:!1},{id:2,senderId:null===b||void 0===b?void 0:b.id,message:"Thank you! I really enjoyed your questions during the Q&A",timestamp:new Date(Date.now()-24e4),sent:!0},{id:3,senderId:1,message:"Would love to collaborate on a project sometime",timestamp:new Date(Date.now()-18e4),sent:!1}],2:[{id:4,senderId:2,message:"Would love to collaborate on the AI project",timestamp:new Date(Date.now()-6e5),sent:!1},{id:5,senderId:null===b||void 0===b?void 0:b.id,message:"Absolutely! When are you free to discuss?",timestamp:new Date(Date.now()-54e4),sent:!0}]});(0,a.useEffect)(()=>{P()},[H,f]);const P=()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},W=async e=>{if(e.preventDefault(),!j.trim()||!f)return;var t;await F(f,j)&&(y(""),null===(t=D.current)||void 0===t||t.focus())},R=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),z=e=>{const t=new Date,s=new Date(e),a=t-s,n=Math.floor(a/864e5);return 0===n?"Today":1===n?"Yesterday":n<7?"".concat(n," days ago"):s.toLocaleDateString()},K=e=>{let{items:t,type:s}=e;return(0,o.jsx)("div",{className:"space-y-2",role:"list","aria-label":"".concat("group"===s?"Group forums":"Direct messages"),children:t.map(e=>(0,o.jsx)("button",{type:"button",className:"w-full p-4 rounded-lg cursor-pointer transition-colors text-left ".concat(f===e.id?"bg-custom-teal bg-opacity-20 border-l-4 border-custom-teal":"bg-custom-bg-2 hover:bg-custom-bg border border-custom-border"),onClick:()=>v(e.id),"aria-current":f===e.id?"true":void 0,"aria-label":"Chat with ".concat(e.name,". Last message: ").concat(e.lastMessage||e.description||"No messages"),children:(0,o.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,o.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-custom-blue to-custom-teal flex items-center justify-center text-white font-bold",children:e.initials||e.avatar}),(0,o.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsx)("h3",{className:"font-semibold text-custom-text truncate",children:e.name}),(0,o.jsx)("span",{className:"text-xs text-custom-text-secondary",children:z(e.lastMessageTime||e.lastSeen)})]}),(0,o.jsx)("p",{className:"text-sm text-custom-text-secondary truncate",children:"group"===s?e.description:e.lastMessage||"Start a conversation"}),"group"===s&&(0,o.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,o.jsxs)("span",{className:"text-xs text-custom-text-secondary",children:[e.members," members"]}),e.unread>0&&(0,o.jsx)("span",{className:"bg-red-500 text-white text-xs rounded-full px-2 py-1",children:e.unread})]})]})]})},e.id))})},V=e=>{let{message:t,isOwn:s}=e;return(0,o.jsx)("div",{className:"flex ".concat(s?"justify-end":"justify-start"," mb-4"),role:"article","aria-label":"Message ".concat(s?"sent by you":"received"," at ").concat(R(t.timestamp)),children:(0,o.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(s?"bg-custom-teal text-black":"bg-custom-bg-2 text-custom-text border border-custom-border"),children:[(0,o.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:t.message}),(0,o.jsx)("time",{className:"text-xs mt-1 block ".concat(s?"text-black opacity-70":"text-custom-text-secondary"),dateTime:new Date(t.timestamp).toISOString(),children:R(t.timestamp)})]})})};return(0,o.jsxs)("div",{className:"bg-custom-bg text-custom-text min-h-screen",children:[(0,o.jsx)(n.A,{}),(0,o.jsx)("main",{className:"container mx-auto px-4 lg:px-8 py-8",id:"main-content",children:(0,o.jsxs)("div",{className:"bg-custom-bg-2 rounded-lg border border-custom-border h-[calc(100vh-200px)] flex",children:[(0,o.jsxs)("aside",{className:"w-1/3 border-r border-custom-border flex flex-col","aria-label":"Message list",children:[(0,o.jsxs)("div",{className:"p-4 border-b border-custom-border space-y-4",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsx)("h1",{className:"text-xl font-bold text-custom-text",children:"Messages"}),(0,o.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text hover:bg-custom-bg rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2","aria-label":"Start new conversation",children:(0,o.jsx)("span",{className:"material-icons",children:"edit"})})]}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{type:"text",placeholder:"Search messages...",value:C,onChange:e=>M(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-custom-bg border border-custom-border rounded-lg text-custom-text placeholder-custom-text-secondary focus:outline-none focus:ring-2 focus:ring-custom-teal",onFocus:()=>S(!0),onBlur:()=>setTimeout(()=>S(!1),200)}),(0,o.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-custom-text-secondary",children:(0,o.jsx)("span",{className:"material-icons text-sm",children:"search"})}),C&&(0,o.jsx)("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-custom-text-secondary hover:text-custom-text",onClick:()=>M(""),"aria-label":"Clear search",children:(0,o.jsx)("span",{className:"material-icons text-sm",children:"close"})})]}),(0,o.jsxs)("div",{className:"flex space-x-1 bg-custom-bg p-1 rounded-lg",role:"tablist","aria-label":"Message categories",children:[(0,o.jsx)("button",{type:"button",role:"tab","aria-selected":"direct"===N,"aria-controls":"chat-list-panel",className:"flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal ".concat("direct"===N?"bg-custom-teal text-black":"text-custom-text-secondary hover:text-custom-text"),onClick:()=>w("direct"),children:"Direct Messages"}),(0,o.jsx)("button",{type:"button",role:"tab","aria-selected":"groups"===N,"aria-controls":"chat-list-panel",className:"flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal ".concat("groups"===N?"bg-custom-teal text-black":"text-custom-text-secondary hover:text-custom-text"),onClick:()=>w("groups"),children:"Group Forums"})]})]}),(0,o.jsx)("div",{id:"chat-list-panel",role:"tabpanel",className:"flex-1 overflow-y-auto p-4","aria-label":"".concat("direct"===N?"Direct messages":"Group forums"," list"),children:"direct"===N?(0,o.jsx)(K,{items:p,type:"direct"}):(0,o.jsx)(K,{items:q,type:"group"})})]}),(0,o.jsx)("section",{className:"flex-1 flex flex-col","aria-label":"Chat conversation",children:f?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("header",{className:"p-4 border-b border-custom-border bg-custom-bg-2",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-custom-blue to-custom-teal flex items-center justify-center text-white font-bold ring-2 ring-custom-teal ring-offset-2 ring-offset-custom-bg-2",role:"img","aria-label":"".concat("direct"===N?null===(e=p.find(e=>e.id===f))||void 0===e?void 0:e.name:null===(t=q.find(e=>e.id===f))||void 0===t?void 0:t.name," avatar"),children:"direct"===N?null===(s=p.find(e=>e.id===f))||void 0===s?void 0:s.initials:null===(m=q.find(e=>e.id===f))||void 0===m?void 0:m.avatar}),"direct"===N&&(0,o.jsx)("span",{className:"absolute bottom-0 right-0 h-3 w-3 bg-green-500 border-2 border-white rounded-full","aria-label":"Online"})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("h2",{className:"font-semibold text-custom-text flex items-center space-x-2",children:[(0,o.jsx)("span",{children:"direct"===N?null===(u=p.find(e=>e.id===f))||void 0===u?void 0:u.name:null===(x=q.find(e=>e.id===f))||void 0===x?void 0:x.name}),"group"===N&&(0,o.jsx)("span",{className:"bg-custom-teal text-black text-xs px-2 py-1 rounded-full",children:"Group"})]}),(0,o.jsx)("p",{className:"text-sm text-custom-text-secondary flex items-center space-x-2",children:"direct"===N?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:"flex items-center",children:[(0,o.jsx)("span",{className:"h-2 w-2 bg-green-500 rounded-full mr-2"}),(0,o.jsx)("span",{"aria-label":"User is online",children:"Online"})]}),(0,o.jsx)("span",{children:"\u2022"}),(0,o.jsx)("span",{children:"Last active 2m ago"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:"flex items-center",children:[(0,o.jsx)("span",{className:"material-icons text-sm mr-1",children:"group"}),(0,o.jsxs)("span",{children:[null===(g=q.find(e=>e.id===f))||void 0===g?void 0:g.members," members"]})]}),(0,o.jsx)("span",{children:"\u2022"}),(0,o.jsx)("span",{children:"3 online"})]})})]})]}),(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text hover:bg-custom-bg rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2","aria-label":"Start video call",children:(0,o.jsx)("span",{className:"material-icons",children:"videocam"})}),(0,o.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text hover:bg-custom-bg rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2","aria-label":"Start voice call",children:(0,o.jsx)("span",{className:"material-icons",children:"call"})}),(0,o.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text hover:bg-custom-bg rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2","aria-label":"View chat information",children:(0,o.jsx)("span",{className:"material-icons",children:"info"})})]})]})}),(0,o.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",role:"log","aria-live":"polite","aria-atomic":"false","aria-label":"Chat messages",children:[null===(h=H[f])||void 0===h?void 0:h.sort((e,t)=>(e.sequence||0)-(t.sequence||0)).map(e=>(0,o.jsx)(V,{message:e,isOwn:e.senderId===(null===b||void 0===b?void 0:b.id)},e.id)),(0,o.jsx)("div",{ref:A,"aria-hidden":"true"})]}),(0,o.jsxs)("footer",{className:"p-4 border-t border-custom-border",children:[(0,o.jsx)("form",{onSubmit:W,className:"space-y-4","aria-label":"Send message",children:(0,o.jsxs)("div",{className:"flex space-x-3",children:[(0,o.jsxs)("div",{className:"flex-1 relative",children:[(0,o.jsx)("label",{htmlFor:"message-input",className:"sr-only",children:"Type your message"}),(0,o.jsx)("textarea",{id:"message-input",ref:D,value:j,onChange:e=>{y(e.target.value),L(f)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),W(e))},placeholder:"Type a message... (Press Enter to send, Shift+Enter for new line)",maxLength:"1000",rows:1,className:"w-full px-4 py-3 bg-custom-bg border border-custom-border rounded-lg text-custom-text focus:outline-none focus:ring-2 focus:ring-custom-teal resize-none",style:{minHeight:"2.5rem",maxHeight:"8rem"},"aria-describedby":"message-limit",autoComplete:"off"}),(0,o.jsx)("div",{className:"absolute bottom-2 right-2 flex items-center space-x-2 text-custom-text-secondary text-xs",children:(0,o.jsxs)("span",{children:[j.length,"/1000"]})})]}),(0,o.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,o.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2 rounded-lg","aria-label":"Attach file",children:(0,o.jsx)("span",{className:"material-icons",children:"attach_file"})}),(0,o.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2 rounded-lg","aria-label":"Add emoji",children:(0,o.jsx)("span",{className:"material-icons",children:"mood"})}),(0,o.jsxs)("button",{type:"submit",disabled:!j.trim(),className:"bg-custom-teal text-black px-6 py-2 rounded-lg hover:bg-opacity-80 transition-all duration-300 flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2 transform hover:scale-105","aria-label":"Send message",children:[(0,o.jsx)("span",{className:"material-icons text-sm","aria-hidden":"true",children:"send"}),(0,o.jsx)("span",{children:"Send"})]})]})]})}),I[f]&&(0,o.jsxs)("div",{className:"text-xs text-custom-text-secondary mt-1 flex items-center",children:[(0,o.jsx)("span",{className:"material-icons text-sm mr-1",children:"edit"}),"Someone is typing..."]})]})]}):(0,o.jsx)("div",{className:"flex-1 flex items-center justify-center",role:"status","aria-live":"polite",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("span",{className:"material-icons text-6xl text-custom-text-secondary mb-4 block","aria-hidden":"true",children:"chat_bubble_outline"}),(0,o.jsx)("h3",{className:"text-xl font-semibold text-custom-text mb-2",children:"Select a conversation"}),(0,o.jsx)("p",{className:"text-custom-text-secondary",children:"Choose from your existing conversations or start a new one"})]})})})]})})]})}},3415:(e,t,s)=>{s.d(t,{Pu:()=>o,jZ:()=>n});s(9379);var a=s(7977);const n=e=>e?a.A.sanitize(e,{ALLOWED_TAGS:[]}):"",o=e=>n(e).trim()}}]);
//# sourceMappingURL=974.1c8ead31.chunk.js.map