"use strict";(self.webpackChunkcampus_connect_react=self.webpackChunkcampus_connect_react||[]).push([[974],{974:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var a=s(5043),n=s(5475),o=s(1056),r=s(579);var i=s(5016),c=s(4032),l=s(9379),d=s(6471),m=s(3415);const u=()=>{var e,t,s,u,x,g,h,b;const[f]=(0,n.ok)(),{user:p}=(0,i.A)(),{connections:v}=(0,c.M)(),[j,y]=(0,a.useState)(null),[N,w]=(0,a.useState)(""),[A,k]=(0,a.useState)("direct"),D=(0,a.useRef)(null),S=(0,a.useRef)(null),[C,M]=(0,a.useState)(!1),[I,T]=(0,a.useState)("");(0,a.useEffect)(()=>{const e=f.get("userId");if(e){const t=parseInt(e),s=v.find(e=>e.id===t);s&&(y(s),k("direct"))}},[f,v]);const{messages:F,isTyping:E,sendChatMessage:L,handleTypingStart:_,loadChatHistory:G,retryMessage:q,markAsRead:H}=(()=>{const{user:e}=(0,i.A)(),{connections:t,sendMessage:s}=(0,c.M)(),{showError:n}=(0,d.h)(),[o,r]=(0,a.useState)({}),[u,x]=(0,a.useState)({}),[g,h]=(0,a.useState)({});(0,a.useEffect)(()=>(console.log("Setting up chat connection..."),()=>{console.log("Cleaning up chat connection...")}),[]);const b=(0,a.useCallback)((e,t)=>{r(s=>{var a;return(0,l.A)((0,l.A)({},s),{},{[e]:[...s[e]||[],{id:Date.now(),senderId:t.senderId,message:t.content,timestamp:new Date,sequence:((null===(a=s[e])||void 0===a?void 0:a.length)||0)+1,sent:!1}]})})},[]),f=(0,a.useCallback)(async(t,a)=>{var i;const c=(0,m.Pu)(a);if(!c)return n("Message contains invalid content"),!1;const d=Date.now(),u={id:d,senderId:null===e||void 0===e?void 0:e.id,message:c,timestamp:new Date,sequence:((null===(i=o[t])||void 0===i?void 0:i.length)||0)+1,sent:!0,pending:!0};r(e=>(0,l.A)((0,l.A)({},e),{},{[t]:[...e[t]||[],u]}));try{return await s(t,c),r(e=>(0,l.A)((0,l.A)({},e),{},{[t]:e[t].map(e=>e.id===d?(0,l.A)((0,l.A)({},e),{},{pending:!1}):e)})),!0}catch(x){return r(e=>(0,l.A)((0,l.A)({},e),{},{[t]:e[t].map(e=>e.id===d?(0,l.A)((0,l.A)({},e),{},{failed:!0}):e)})),n("Failed to send message. Please try again."),!1}},[null===e||void 0===e?void 0:e.id,o,s,n]),p=(0,a.useCallback)(e=>{g[e]&&clearTimeout(g[e]),x(t=>(0,l.A)((0,l.A)({},t),{},{[e]:!0}));const t=setTimeout(()=>{x(t=>(0,l.A)((0,l.A)({},t),{},{[e]:!1}))},3e3);h(s=>(0,l.A)((0,l.A)({},s),{},{[e]:t}))},[g]),v=(0,a.useCallback)(async e=>{try{console.log("Loading chat history for ".concat(e,"..."))}catch(t){n("Failed to load chat history")}},[n]),j=(0,a.useCallback)(async(e,t)=>{var s;const a=null===(s=o[e])||void 0===s?void 0:s.find(e=>e.id===t);if(a)return r(s=>(0,l.A)((0,l.A)({},s),{},{[e]:s[e].filter(e=>e.id!==t)})),f(e,a.message)},[o,f]),y=(0,a.useCallback)(e=>{console.log("Marking messages as read for chat ".concat(e))},[]);return{messages:o,isTyping:u,sendChatMessage:f,handleTypingStart:p,loadChatHistory:v,retryMessage:j,markAsRead:y,handleIncomingMessage:b}})(),[O]=(0,a.useState)([{id:"ai-workshop",name:"AI Workshop Discussion",description:"Discuss AI development techniques and share resources",members:45,lastMessage:"Great session today! Anyone has the slides?",lastMessageTime:new Date(Date.now()-3e5),unread:3,avatar:"AI"},{id:"career-fair",name:"Career Fair 2025",description:"Tips, experiences, and networking for the upcoming career fair",members:120,lastMessage:"Microsoft booth was amazing!",lastMessageTime:new Date(Date.now()-6e5),unread:0,avatar:"CF"},{id:"hackathon-team",name:"Innovation Challenge Team",description:"Coordination for the 48-hour hackathon",members:8,lastMessage:"Meeting at 2 PM in lab 3",lastMessageTime:new Date(Date.now()-9e5),unread:1,avatar:"HC"}]),[P,W]=(0,a.useState)({1:[{id:1,senderId:1,message:"Hey! Great presentation today!",timestamp:new Date(Date.now()-3e5),sent:!1},{id:2,senderId:null===p||void 0===p?void 0:p.id,message:"Thank you! I really enjoyed your questions during the Q&A",timestamp:new Date(Date.now()-24e4),sent:!0},{id:3,senderId:1,message:"Would love to collaborate on a project sometime",timestamp:new Date(Date.now()-18e4),sent:!1}],2:[{id:4,senderId:2,message:"Would love to collaborate on the AI project",timestamp:new Date(Date.now()-6e5),sent:!1},{id:5,senderId:null===p||void 0===p?void 0:p.id,message:"Absolutely! When are you free to discuss?",timestamp:new Date(Date.now()-54e4),sent:!0}]});(0,a.useEffect)(()=>{R()},[P,j]);const R=()=>{var e;null===(e=D.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},z=async e=>{if(e.preventDefault(),!N.trim()||!j)return;var t;await L(j,N)&&(w(""),null===(t=S.current)||void 0===t||t.focus())},K=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),V=e=>{const t=new Date,s=new Date(e),a=t-s,n=Math.floor(a/864e5);return 0===n?"Today":1===n?"Yesterday":n<7?"".concat(n," days ago"):s.toLocaleDateString()},B=e=>{let{items:t,type:s}=e;return(0,r.jsx)("div",{className:"space-y-2",role:"list","aria-label":"".concat("group"===s?"Group forums":"Direct messages"),children:t.map(e=>(0,r.jsx)("button",{type:"button",className:"w-full p-4 rounded-lg cursor-pointer transition-colors text-left ".concat(j===e.id?"bg-custom-teal bg-opacity-20 border-l-4 border-custom-teal":"bg-custom-bg-2 hover:bg-custom-bg border border-custom-border"),onClick:()=>y(e.id),"aria-current":j===e.id?"true":void 0,"aria-label":"Chat with ".concat(e.name,". Last message: ").concat(e.lastMessage||e.description||"No messages"),children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-custom-blue to-custom-teal flex items-center justify-center text-white font-bold",children:e.initials||e.avatar}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"font-semibold text-custom-text truncate",children:e.name}),(0,r.jsx)("span",{className:"text-xs text-custom-text-secondary",children:V(e.lastMessageTime||e.lastSeen)})]}),(0,r.jsx)("p",{className:"text-sm text-custom-text-secondary truncate",children:"group"===s?e.description:e.lastMessage||"Start a conversation"}),"group"===s&&(0,r.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,r.jsxs)("span",{className:"text-xs text-custom-text-secondary",children:[e.members," members"]}),e.unread>0&&(0,r.jsx)("span",{className:"bg-red-500 text-white text-xs rounded-full px-2 py-1",children:e.unread})]})]})]})},e.id))})},Q=e=>{let{message:t,isOwn:s}=e;return(0,r.jsx)("div",{className:"flex ".concat(s?"justify-end":"justify-start"," mb-4"),role:"article","aria-label":"Message ".concat(s?"sent by you":"received"," at ").concat(K(t.timestamp)),children:(0,r.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(s?"bg-custom-teal text-black":"bg-custom-bg-2 text-custom-text border border-custom-border"),children:[(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:t.message}),(0,r.jsx)("time",{className:"text-xs mt-1 block ".concat(s?"text-black opacity-70":"text-custom-text-secondary"),dateTime:new Date(t.timestamp).toISOString(),children:K(t.timestamp)})]})})};return(0,r.jsxs)("div",{className:"bg-custom-bg text-custom-text min-h-screen",children:[(0,r.jsx)(o.A,{}),(0,r.jsx)("main",{className:"container mx-auto px-4 lg:px-8 py-8",id:"main-content",children:(0,r.jsxs)("div",{className:"bg-custom-bg-2 rounded-lg border border-custom-border h-[calc(100vh-200px)] flex",children:[(0,r.jsxs)("aside",{className:"w-1/3 border-r border-custom-border flex flex-col","aria-label":"Message list",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-custom-border space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-custom-text",children:"Messages"}),(0,r.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text hover:bg-custom-bg rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2","aria-label":"Start new conversation",children:(0,r.jsx)("span",{className:"material-icons",children:"edit"})})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",placeholder:"Search messages...",value:I,onChange:e=>T(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-custom-bg border border-custom-border rounded-lg text-custom-text placeholder-custom-text-secondary focus:outline-none focus:ring-2 focus:ring-custom-teal",onFocus:()=>M(!0),onBlur:()=>setTimeout(()=>M(!1),200)}),(0,r.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-custom-text-secondary",children:(0,r.jsx)("span",{className:"material-icons text-sm",children:"search"})}),I&&(0,r.jsx)("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-custom-text-secondary hover:text-custom-text",onClick:()=>T(""),"aria-label":"Clear search",children:(0,r.jsx)("span",{className:"material-icons text-sm",children:"close"})})]}),(0,r.jsxs)("div",{className:"flex space-x-1 bg-custom-bg p-1 rounded-lg",role:"tablist","aria-label":"Message categories",children:[(0,r.jsx)("button",{type:"button",role:"tab","aria-selected":"direct"===A,"aria-controls":"chat-list-panel",className:"flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal ".concat("direct"===A?"bg-custom-teal text-black":"text-custom-text-secondary hover:text-custom-text"),onClick:()=>k("direct"),children:"Direct Messages"}),(0,r.jsx)("button",{type:"button",role:"tab","aria-selected":"groups"===A,"aria-controls":"chat-list-panel",className:"flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal ".concat("groups"===A?"bg-custom-teal text-black":"text-custom-text-secondary hover:text-custom-text"),onClick:()=>k("groups"),children:"Group Forums"})]})]}),(0,r.jsx)("div",{id:"chat-list-panel",role:"tabpanel",className:"flex-1 overflow-y-auto p-4","aria-label":"".concat("direct"===A?"Direct messages":"Group forums"," list"),children:"direct"===A?(0,r.jsx)(B,{items:v,type:"direct"}):(0,r.jsx)(B,{items:O,type:"group"})})]}),(0,r.jsx)("section",{className:"flex-1 flex flex-col","aria-label":"Chat conversation",children:j?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("header",{className:"p-4 border-b border-custom-border bg-custom-bg-2",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-custom-blue to-custom-teal flex items-center justify-center text-white font-bold ring-2 ring-custom-teal ring-offset-2 ring-offset-custom-bg-2",role:"img","aria-label":"".concat("direct"===A?null===(e=v.find(e=>e.id===j))||void 0===e?void 0:e.name:null===(t=O.find(e=>e.id===j))||void 0===t?void 0:t.name," avatar"),children:"direct"===A?null===(s=v.find(e=>e.id===j))||void 0===s?void 0:s.initials:null===(u=O.find(e=>e.id===j))||void 0===u?void 0:u.avatar}),"direct"===A&&(0,r.jsx)("span",{className:"absolute bottom-0 right-0 h-3 w-3 bg-green-500 border-2 border-white rounded-full","aria-label":"Online"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"font-semibold text-custom-text flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"direct"===A?null===(x=v.find(e=>e.id===j))||void 0===x?void 0:x.name:null===(g=O.find(e=>e.id===j))||void 0===g?void 0:g.name}),"group"===A&&(0,r.jsx)("span",{className:"bg-custom-teal text-black text-xs px-2 py-1 rounded-full",children:"Group"})]}),(0,r.jsx)("p",{className:"text-sm text-custom-text-secondary flex items-center space-x-2",children:"direct"===A?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"h-2 w-2 bg-green-500 rounded-full mr-2"}),(0,r.jsx)("span",{"aria-label":"User is online",children:"Online"})]}),(0,r.jsx)("span",{children:"\u2022"}),(0,r.jsx)("span",{children:"Last active 2m ago"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"material-icons text-sm mr-1",children:"group"}),(0,r.jsxs)("span",{children:[null===(h=O.find(e=>e.id===j))||void 0===h?void 0:h.members," members"]})]}),(0,r.jsx)("span",{children:"\u2022"}),(0,r.jsx)("span",{children:"3 online"})]})})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text hover:bg-custom-bg rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2","aria-label":"Start video call",children:(0,r.jsx)("span",{className:"material-icons",children:"videocam"})}),(0,r.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text hover:bg-custom-bg rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2","aria-label":"Start voice call",children:(0,r.jsx)("span",{className:"material-icons",children:"call"})}),(0,r.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text hover:bg-custom-bg rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2","aria-label":"View chat information",children:(0,r.jsx)("span",{className:"material-icons",children:"info"})})]})]})}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",role:"log","aria-live":"polite","aria-atomic":"false","aria-label":"Chat messages",children:[null===(b=P[j])||void 0===b?void 0:b.sort((e,t)=>(e.sequence||0)-(t.sequence||0)).map(e=>(0,r.jsx)(Q,{message:e,isOwn:e.senderId===(null===p||void 0===p?void 0:p.id)},e.id)),(0,r.jsx)("div",{ref:D,"aria-hidden":"true"})]}),(0,r.jsxs)("footer",{className:"p-4 border-t border-custom-border",children:[(0,r.jsx)("form",{onSubmit:z,className:"space-y-4","aria-label":"Send message",children:(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)("label",{htmlFor:"message-input",className:"sr-only",children:"Type your message"}),(0,r.jsx)("textarea",{id:"message-input",ref:S,value:N,onChange:e=>{w(e.target.value),_(j)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),z(e))},placeholder:"Type a message... (Press Enter to send, Shift+Enter for new line)",maxLength:"1000",rows:1,className:"w-full px-4 py-3 bg-custom-bg border border-custom-border rounded-lg text-custom-text focus:outline-none focus:ring-2 focus:ring-custom-teal resize-none",style:{minHeight:"2.5rem",maxHeight:"8rem"},"aria-describedby":"message-limit",autoComplete:"off"}),(0,r.jsx)("div",{className:"absolute bottom-2 right-2 flex items-center space-x-2 text-custom-text-secondary text-xs",children:(0,r.jsxs)("span",{children:[N.length,"/1000"]})})]}),(0,r.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,r.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2 rounded-lg","aria-label":"Attach file",children:(0,r.jsx)("span",{className:"material-icons",children:"attach_file"})}),(0,r.jsx)("button",{type:"button",className:"p-2 text-custom-text-secondary hover:text-custom-text focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2 rounded-lg","aria-label":"Add emoji",children:(0,r.jsx)("span",{className:"material-icons",children:"mood"})}),(0,r.jsxs)("button",{type:"submit",disabled:!N.trim(),className:"bg-custom-teal text-black px-6 py-2 rounded-lg hover:bg-opacity-80 transition-all duration-300 flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-custom-teal focus:ring-offset-2 transform hover:scale-105","aria-label":"Send message",children:[(0,r.jsx)("span",{className:"material-icons text-sm","aria-hidden":"true",children:"send"}),(0,r.jsx)("span",{children:"Send"})]})]})]})}),E[j]&&(0,r.jsxs)("div",{className:"text-xs text-custom-text-secondary mt-1 flex items-center",children:[(0,r.jsx)("span",{className:"material-icons text-sm mr-1",children:"edit"}),"Someone is typing..."]})]})]}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",role:"status","aria-live":"polite",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("span",{className:"material-icons text-6xl text-custom-text-secondary mb-4 block","aria-hidden":"true",children:"chat_bubble_outline"}),(0,r.jsx)("h3",{className:"text-xl font-semibold text-custom-text mb-2",children:"Select a conversation"}),(0,r.jsx)("p",{className:"text-custom-text-secondary",children:"Choose from your existing conversations or start a new one"})]})})})]})})]})}},3415:(e,t,s)=>{s.d(t,{Pu:()=>o,jZ:()=>n});s(9379);var a=s(7977);const n=e=>e?a.A.sanitize(e,{ALLOWED_TAGS:[]}):"",o=e=>n(e).trim()}}]);
//# sourceMappingURL=974.cb24d0da.chunk.js.map